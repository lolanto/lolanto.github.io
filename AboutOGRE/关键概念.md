# OGRE RenderSystem的关键概念

---

## SceneManager



## RenderSystem

不同图新API初始化过程可能需要设置不同类型的参数，OGRE在这里使用字符串形式的(key-value)对作为参数。

RenderSystem维护渲染管线的状态，包括顶点绕序，是否开启深度测试，是否进行模板测试，是否需要alpha混合等。

同时还会维护构成管线的资源，包括shader，vertex buffer，texture，render target以及shader的参数进行设置

(index buffer?)

渲染系统的入口：`virtual void _render(const RenderOperation& op);`

*该函数从当前激活viewport所关联的camera进行渲染，将渲染结果记录到viewport所关联的renderTarget上*

在DX11中，_render函数执行过程包括更新DX用到的渲染管线状态对象，绑定各个shader，最后根据是否使用index选择draw命令

疑问：vertex buffer和index buffer怎么来？shader_resource怎么来？

## RenderOperation



## GPUProgram



## RenderTarget

这是一个抽象基类，可以理解为对一切可**承载渲染结果**的对象的抽象。

![RenderTarget继承关系](./diagram/RenderTarget继承关系.svg)

可以肯定的是这个类负责创建**viewport**，一个RenderTarget能够同时拥有**多个**viewport。一个viewport与一个camera联系，决定了通过这个camera渲染的结果会被保存在由viewport指定的renderTarget的局部/全部区域。

camera，viewport，RenderTarget三者之间的关系：

![camera，viewport，RenderTarget三者之间的关系](./diagram/camera_viewport_renderTarget_relationship.svg)

RenderTarget同时还拥有DepthBuffer，不过该缓存作为索引的形式存在，估计是有Buffer Manager，利用索引获得DepthBuffer。至于DepthBuffer对RenderTarget的作用，毋庸置疑是对渲染结果进行深度检测。

## RenderQueue